<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
	 xmlns:bal="http://schemas.microsoft.com/wix/BalExtension"
   xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Bundle Name="Bootstrapper" Version="1.0.0.0" Manufacturer="Rainer Stropek" UpgradeCode="06A19F6F-688C-44A6-B3D3-26F72DE50689"
			DisableModify="no">
    <BootstrapperApplicationRef Id="ManagedBootstrapperApplicationHost">
      <Payload Name="BootstrapperCore.config" SourceFile="$(var.InstallerUI.TargetDir)InstallerUI.BootstrapperCore.config" />
      <Payload SourceFile="$(var.InstallerUI.TargetPath)" />
      <Payload SourceFile="$(var.InstallerUI.TargetDir)Microsoft.Practices.Prism.Mvvm.dll" />
      <Payload SourceFile="$(var.InstallerUI.TargetDir)Microsoft.Practices.Prism.Mvvm.Desktop.dll" />
      <Payload SourceFile="$(var.InstallerUI.TargetDir)Microsoft.Practices.Prism.SharedInterfaces.dll" />
      <Payload SourceFile="$(var.InstallerUI.TargetDir)Newtonsoft.Json.dll" />
      <Payload SourceFile="Settings.json" />
      <PayloadGroupRef Id="LicensePayload"/>
    </BootstrapperApplicationRef>

    <!-- Check if the Molecule Profiler is installed. This is to make sure that uninstall removes the SciexMoleculeProfileBootstrapper.exe -->
    <util:FileSearch
      Id='FileSearchCheckIfMoleculeProfileIsInstalled'
      Variable="IsMoleculeProfileInstalled"
      Result="exists"
      Path="[ProgramFilesFolder]\SciexMoleculeProfiler\SciexMoleculeProfiler.txt"/>

    <!-- Variables modified by custom WPF UI -->
    <Variable bal:Overridable="yes" Name="Prerequisite" Value=""/>
    <Variable bal:Overridable="yes" Name="InstallLevel" Value="1"/>

    <!--https://teamcity.netadds.net/repository/download/SciexPdv_LayeredBuilds_ApplicationsAndProducts_BuildInstallers/59464259:id/
                      output.zip!/Setup/Install/postgresql-16.2-1-windows-x64.exe-->
    <Chain>
      <PackageGroupRef Id='NetFx45Web' />
      <ExePackage Id="SciexMoleculeProfilerBootstrapper"
                  Name="SciexMoleculeProfilerBootstrapper.exe"
                  DownloadUrl="http://{0}/MyMsi/SciexMoleculeProfiler/SciexMoleculeProfilerBootstrapper.exe"
                  InstallCommand="/S"
                  UninstallCommand="/uninstall /quiet"
                  DetectCondition="IsMoleculeProfileInstalled"
                  Compressed="no"
                  Cache="yes"
                  Permanent="no"
                  Vital="yes"
                  SuppressSignatureVerification="no">
        <RemotePayload
          ProductName="Sciex Molecule Profiler Bootstrapper"
          Description="Sciex Molecule Profiler Bootstrapper"
          Hash="1D4950F227C8DC662A668F0F5901AC89421F49A9"
          CertificatePublicKey="126C892FD591AD2CE058EC194DB5CE85E528A9BB"
          CertificateThumbprint="AA9325AB2EDFF4A5D745205CBD25B440CB89FDEB"
          Size="583544"
          Version="1.0.0.0"/>
      </ExePackage>
      <MsiPackage Id="FirstInstaller" SourceFile="$(var.FirstInstaller.TargetPath)" Visible="yes">
        <MsiProperty Name="PREREQUISITE" Value="[Prerequisite]"/>
        <MsiProperty Name="INSTALLLEVEL" Value="[InstallLevel]"/>
      </MsiPackage>
      <MsiPackage Id="SecondInstaller" SourceFile="$(var.SecondInstaller.TargetPath)" Visible="yes">
        <MsiProperty Name="PREREQUISITE" Value="[Prerequisite]"/>
        <MsiProperty Name="INSTALLLEVEL" Value="[InstallLevel]"/>
      </MsiPackage>
    </Chain>
  </Bundle>

  <!-- License data -->
  <Fragment>
    <!-- Payload for license file -->
    <PayloadGroup Id="LicensePayload">
      <Payload SourceFile="License.txt" />
    </PayloadGroup>

    <!-- Add custom table with reference to license file -->
    <CustomTable Id='LicenseInformation'>
      <Row>
        <Data Column='LicenseFile'>License.txt</Data>
      </Row>
    </CustomTable>
  </Fragment>

  <!-- Custom table definition for license file data -->
  <Fragment>
    <CustomTable Id='LicenseInformation' BootstrapperApplicationData='yes'>
      <Column Id='LicenseFile' Category='Text' Type='string' Width='0' Nullable='yes' PrimaryKey='yes' />
    </CustomTable>
  </Fragment>
</Wix>